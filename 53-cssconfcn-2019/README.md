# 新时代CSS布局

*在中国第五届CSS大会的演讲抄本.*

大家好。很开心可以来到这里跟大家分享关于CSS布局的一些新进展。能够与那么多出色的CSS专家同台是我的荣幸。这是我第一次在中国演讲，也是第一次用中文演讲，所以如果有哪儿些用词不当的地方或者是一些词汇翻译的很古怪，要事先请大家多多包涵。

首先，让我来做个自我介绍。我姓陈，名叫慧晶，来自马来西亚。我曾经当过全职篮球选手，也因此无意间走上网络开发这条路。若你觉得很好奇，篮球怎么会跟网络开发扯上关系，那当会儿可以找我聊聊。

从入行到现在，我一直都觉得CSS是一样相当有趣的东西，所以会经常探索新属性或更深入了解现有的属性，并且把学习经验写在博客上。去年也加入了谋智（Mozilla）技术讲师组，这项倡议主要是要协助科技布道和指导师在世界各地的技术会议推广开源网络科技。谋智会给予组员多方面的支持，如演讲培训、技术训练、资金等。

现在我在Nexmo担任开发大使，是开发者关系团队的成员。Nexmo是个通讯API平台，提供信息，语音，认证，音视屏等API，好让开发者轻松把通信功能添加入自己的APP内。

那让我们进入正题吧，也就是新时代CSS布局。想请问在座的朋友们有几位参加过2016年的CSS大会？想请问在座的朋友们有几位参加过2016年的CSS大会？虽然，我当时没在场，但是还好有视频，让我有机会在线观赏大漠老师谈CSS Grid Layout的演讲。也很高兴当会儿有机会在现场听他的演讲。当时，他介绍了与Grid相关的各种新属性及它们的应用方法。Grid在那时候都还没正式发布呢。Grid可以算是新时代CSS布局的成员之一吧。

不知道观众朋友们是否同意，但是我认为网络开发其中令人头痛的一点就是纵向的布局。原因是网络原本是个以文字为主的媒介。

当年蒂姆·伯纳斯-李爵士（Sir Tim Berners-Lee）主要是为了解决CERN面临的资讯管理问题。他提交了名为「信息管理：提案」的文件，希望可以更轻易的管理和监控实验室研究流程的建议。这些文件不是用英文就是用法文写的。我也想顺便一提，为了纪念万维网诞生的30周年纪念，CERN召集了一群知名开发者，重建最原始的浏览器。有兴趣的朋友们可以到这个链接在线访问。

早期的浏览器都注重西文文字的排版，重视的是左右的方向。初期的元素包括h1-6的标题元素，p元素，各式的列表元素。CSS在1996年发布时，多数的属性也是为了调整文字的布局而设。但是，CSS也介绍了以盒模型为主的布局方式。其实想一想，网络的所有内容，不都是各式各类的盒子吗？虽然初期的属性有限，但是网络开发者非常有创意，利用浮动、负margin、各式的定位等技巧，来达成心仪的设计。

直到Flexbox的诞生。Flexbox可以算是有史以来第一个以网络本质为主而编写的CSS规范。连同Box Alignment跟CSS Grid，这三个项目可以称为CSS新时代布局的三大栋梁。当然，我们不能忘记CSS里头的其它553个属性。因为CSS是个团队项目。当我们把各属性协调的融合在一起，才能把CSS的威力完全发挥出来。

如果要揭开CSS布局的生秘面纱，那就必须先熟悉浏览器的渲染过程。渲染引擎会把服务器发送过来的Source文档解析成浏览器能够明白的对象。而在渲染网页之前，浏览器会生成一个渲染树。这个渲染树是个中介性的结构（intermediary structure），是文档各式结构（formatting structure）的表示法。CSS在解析的过程，会计算出每个元素和文本节点的每个CSS属性值。浏览器就会靠其中的`display`取值来断定要生成哪儿一类的盒子。

CSS显示模块在这二十多年来，经过不少演变。从一开始的基本`block`、`inline`和`list-item`到现在最新规范中一共有十七种属性值。可见，CSS是个不断在进展的科技，编辑组（CSS Working Group）也会聆听多方面的反馈来更新规范。

Level 3的显示模块主要是为了更换及扩展在CSS2里`display`取值的定义。我在此描述的东西，很有可能还未在浏览器实行，但是我们可以从中事先理解未来CSS的行为。规范提出了两种显示类型，内部及外部。内部显示类型定义了元素内子元素的布局方式，外部显示类型则定义了元素怎样参与流式布局的处理。

这个表是从规范直接抽出来的。它列出之前提到的十七个属性值，也描述这些取值会让浏览器生成什么样的盒子。Level 3规范详细说明了`display`属性的两类取值，可是到现在依然还没被浏览器广泛支持。即使被广泛支持后，单关键字还是可以继续用。

各种属性值生成的盒子会成立不同的格式化上下文（formatting context）。打个比方，这个幻灯片上的词句翻译是用ruby标签来实行的。`display:ruby`会生成ruby容器盒子，而这种盒子建立的是ruby formatting context。

相信大多数的人都有尝试过用Flexbox来布局。可能因为Flexbox的开发过程相当凌乱不堪，属性一而再再而三的修改，网络上Flexbox的教程有时会产生一些误解。最可靠的答案就藏在规范里头。规范编辑强调利用简写的flex属性，因为它会正确的重启相关的属性值。而flex简写有几个关键字，是为了应付最常见的用例而设的。

Flexbox的首个公开工作草案是在2009发布的，而Grid的则是2011发布。当时两个规范设定了两组不同的对齐属性，经过讨论，工作组决定把盒子对齐写成独立的规范，让过去、现在和未来的formatting contexts都统一使用相同的属性。



Grid正式发布到现在，已经有大概两年的时间，浏览器的支持程度如今也高达88%了。

https://arstechnica.com/information-technology/2011/10/before-netscape-forgotten-web-browsers-of-the-early-1990s/